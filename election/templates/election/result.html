{% extends "election/base.html" %}

{% block title %}Result {% endblock %}

{% block content %}
<style>
  .zoom {
    padding: 0px;
    background-color: none;
    transition: transform .2s; 
    width: 50px;
    height: 50px;
  }
  .zoom:hover {
    transform: scale(2);
  }
  #resultTable {
    display: none; /* Hide the table by default */
  }
  #demo {
    font-size: 18px;
  }
</style>

<script>
  // Inject the result date from the backend
  var resultCountdownDate = new Date("{{ result_date|date:'F d, Y H:i:s' }}").getTime();

  var x = setInterval(function () {
    var now = new Date().getTime();
    var distance = resultCountdownDate - now;

    if (distance > 0) {
      var days = Math.floor(distance / (1000 * 60 * 60 * 24));
      var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      var seconds = Math.floor((distance % (1000 * 60)) / 1000);

      document.getElementById("demo").innerHTML = 
        "Time left for result: " + days + "d " + hours + "h " + minutes + "m " + seconds + "s";
    } else {
      clearInterval(x); // Stop the interval when the countdown reaches 0
      document.getElementById("demo").innerHTML = "The result is now available!";
      // Hide voting form and show results after countdown ends
      document.getElementById("resultTable").style.display = "block";
      document.getElementById("voteForm").style.display = "none"; // Hide vote form after results are available
    }
  }, 1000);
</script>

<!-- <h2 style="text-decoration: underline;">Result</h2> 
<div>
  <label for="userDate">Set Countdown Date:</label>
  <input type="datetime-local" id="userDate" name="userDate">
  <button onclick="setCountdown()">Start Countdown</button>
</div> -->

<div id="demo">
  <h4>Result will be available once the voting is complete</h4>
</div>

<!-- Voting Form (Initially Visible Before the Result Date) -->
<div id="voteForm">
  <h3>Vote Here</h3>
  <ol>
    {% for i in positions %}
      <li>
        <a href="{% url 'candidate' pk=i.pk %}" style="color: black;">{{ i.title }}</a>
      </li>
      <br>
    {% empty %}
      <p>No Positions Available :(</p>
    {% endfor %}
  </ol>
</div>

<!-- Result Table (Initially Hidden) -->
<div id="resultTable">
  {% if results %}
  <table class="table text-center">
    <thead>
      <tr>
        <th>#</th>
        <th>Image</th>
        <th>Candidate Name</th>
        <th>Candidate Position</th>
        <th>Total Vote</th>
      </tr>
    </thead>
    <tbody>
      {% for result in results %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td><img src="{{ result.image.url }}" class="zoom"></td>
          <td>{{ result.name }}</td>
          <td>{{ result.position }}</td>
          <td>{{ result.total_vote }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <h4>No results available.</h4>
  {% endif %}
</div>

{% endblock %}
